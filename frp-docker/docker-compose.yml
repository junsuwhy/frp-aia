version: '3.8'

services:
  frps:
    image: snowdreamtech/frps:0.52.3
    container_name: frps
    restart: unless-stopped
    ports:
      - "7000:7000"
      - "7500:7500"
    volumes:
      - ./frps.toml:/etc/frp/frps.toml:ro
      - ./logs:/var/log/frp
    command: -c /etc/frp/frps.toml
    environment:
      - TZ=${TZ:-Asia/Taipei}
    networks:
      - frp_net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  caddy:
    image: caddy:2-alpine
    container_name: caddy
    restart: unless-stopped
    ports:
      - "${CADDY_HTTP_PORT:-80}:80"
      - "${CADDY_HTTPS_PORT:-443}:443"
      - "${CADDY_HTTPS_PORT:-443}:443/udp"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - ./caddy/data:/data
      - ./caddy/config:/config
      - ./install-files:/app/install-files:ro
    environment:
      - DOMAIN=${DOMAIN}
      - EMAIL=${EMAIL}
      - INSTALL_PATH=${INSTALL_PATH:-frp-install}
      - FRP_TOKEN=${FRP_TOKEN}
      - ALLOWED_IPS=${ALLOWED_IPS:-127.0.0.1}
      - TZ=${TZ:-Asia/Taipei}
    depends_on:
      - frps
    networks:
      - frp_net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  frp_net:
    driver: bridge

